<!DOCTYPE html>
<html lang="zh">
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="generator" content="Hugo 0.125.1">
		<title>Feign - 小蜜蜂</title>

		<meta name="description" content="什么是Feign Feign 是 Netflix 开源的声明式 HTTP 客户端，用于简化 RESTful 服务的调用 通过定义接口和注解，Feign 可以自动生成HTTP请求的实现 特点 声明式 API ：通过接口注解定义 HTTP 请求，无需手动编写 HTTP 客户端代码 集成 Ribbon ：默认集成 Ribbon ，支持客户端负载均衡 集成 Hystrix ：支持熔断和降级机制 可扩展性：支持自定义编码器、解码器和拦截器 工作原理 （1）接口定义 使用 @FeignClient 注解定义 Feign 客户端接口 通过方法注解（如 @GetMapping、@PostMapping）定义 HTTP 请求 （2）动态代理 Feign 通过动态代理技术生成接口的实现类 在运行时，Feign 会将方法调用转换为 Http 请求 （3）请求处理 Feign 根据接口定义生成 HTTP 请求，并通过 Ribbon 进行负载均衡 请求结果通过解码器为 Java 对象 （4）集成 Ribbon 和 Hystrix Feign 默认集成了 Ribbon，支持客户端负载均衡 通过配置可以启用 Hystrix，实现熔断和降级 Feign 的配置 （1）基本配置 使用 @FeignClient 注解定义 Feign 客户端： @FeignClient(name = &#34;service-name&#34;, url = &#34;http://localhost:8080&#34;) public interface MyFeignClient { @GetMapping(&#34;/endpoint&#34;) String getResponse(); } （2）负载均衡 * Feign 默认集成了 Ribbon，无需额外配置 * 可以通过配置文件自定义 Ribbon 的负载均衡策略： service-name: ribbon: NFLoadBalancerRuleClassName: com.">


		
		<link rel="shortcut icon" href="/images/logo.png">
		
	
		




<link rel="stylesheet" href="/css/ui.css">

	
		

		<script defer src="/js/dark-mode.js"></script>
		<link disabled id="dark-mode-theme" rel="stylesheet" href="/css/dark.css">
		<link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway">

		
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atelier-savanna-light.min.css">
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
		
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/common.min.js"></script>
		
		
	</head>

<body>
<header class="container no-print">
	<div class="u-header">
		<nav class="bar">
	<ul><li>
			<a href="/">
				<img class="icon-text" src="/img/prev.svg"/>
			</a>
		</li><li><img class="icon-text" id="dark-mode-toggle" src="/img/moon-regular.svg" alt="Toggle Dark Mode"></a></li><li><a href="/about/">了解我</a></li><li><a href="/blog/">博客</a></li><li><a href="/work/">工作</a></li></ul>
</nav>

	</div>
</header>
<main class="container">

<article>
	<header><hgroup id="brand">
	<h1>Feign</h1>
	<h5>
		
		<time datetime="2018-04-22 15:43:54 &#43;0800 CST">2018年 4月 22日</time>
		<span class="no-print">
			-
				
				<a href="/tags/Feign">Feign</a>
				
				<a href="/tags/Spring%20Cloud">Spring Cloud</a>
				<span>
	</h5>
	
</hgroup>
<hr class="sep" />
</header>
	<h2 id="什么是feign">什么是Feign</h2>
<ul>
<li>Feign 是 Netflix 开源的声明式 HTTP 客户端，用于简化 RESTful 服务的调用</li>
<li>通过定义接口和注解，Feign 可以自动生成HTTP请求的实现</li>
</ul>
<h2 id="特点">特点</h2>
<ul>
<li>声明式 API ：通过接口注解定义 HTTP 请求，无需手动编写 HTTP 客户端代码</li>
<li>集成 Ribbon ：默认集成 Ribbon ，支持客户端负载均衡</li>
<li>集成 Hystrix ：支持熔断和降级机制</li>
<li>可扩展性：支持自定义编码器、解码器和拦截器</li>
</ul>
<h2 id="工作原理">工作原理</h2>
<h2 id="1接口定义">（1）接口定义</h2>
<ul>
<li>使用 @FeignClient 注解定义 Feign 客户端接口</li>
<li>通过方法注解（如 <strong>@GetMapping</strong>、<strong>@PostMapping</strong>）定义 HTTP 请求</li>
</ul>
<h3 id="2动态代理">（2）动态代理</h3>
<ul>
<li>Feign 通过动态代理技术生成接口的实现类</li>
<li>在运行时，Feign 会将方法调用转换为 Http 请求</li>
</ul>
<h3 id="3请求处理">（3）请求处理</h3>
<ul>
<li>Feign 根据接口定义生成 HTTP 请求，并通过 Ribbon 进行负载均衡</li>
<li>请求结果通过解码器为 Java 对象</li>
</ul>
<h3 id="4集成-ribbon-和-hystrix">（4）集成 Ribbon 和 Hystrix</h3>
<ul>
<li>Feign 默认集成了 Ribbon，支持客户端负载均衡</li>
<li>通过配置可以启用 Hystrix，实现熔断和降级</li>
</ul>
<h2 id="feign-的配置">Feign 的配置</h2>
<h3 id="1基本配置">（1）基本配置</h3>
<ul>
<li>使用 @FeignClient 注解定义 Feign 客户端：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@FeignClient</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;service-name&#34;</span>, url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://localhost:8080&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MyFeignClient</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getResponse</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2负载均衡">（2）负载均衡</h3>
<h3 id="-feign-默认集成了-ribbon无需额外配置">* Feign 默认集成了 Ribbon，无需额外配置</h3>
<h3 id="-可以通过配置文件自定义-ribbon-的负载均衡策略">* 可以通过配置文件自定义 Ribbon 的负载均衡策略：</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">service-name</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ribbon</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">NFLoadBalancerRuleClassName</span>: <span style="color:#ae81ff">com.netflix.loadbalancer.RoundRobinRule</span>
</span></span></code></pre></div><h3 id="3熔断和降级">（3）熔断和降级</h3>
<ul>
<li>通过 <strong>@FeignClient</strong> 的** Fallback** 属性指定降级类：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@FeignClient</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;service-name&#34;</span>, fallback <span style="color:#f92672">=</span> MyFeignClientFallback.<span style="color:#a6e22e">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MyFeignClient</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/endpoint&#34;</span>)
</span></span><span style="display:flex;"><span>    String <span style="color:#a6e22e">getResponse</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyFeignClientFallback</span> <span style="color:#66d9ef">implements</span> MyFeignClient {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getResponse</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Fallback response&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="4自定义配置">（4）自定义配置</h3>
<ul>
<li>通过 **@Configuration **类自定义 Feign 的编码器、解码器和拦截器：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FeignConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Encoder <span style="color:#a6e22e">feignEncoder</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> JacksonEncoder();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Decoder <span style="color:#a6e22e">feignDecoder</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> JacksonDecoder();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> RequestInterceptor <span style="color:#a6e22e">feignRequestInterceptor</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> template <span style="color:#f92672">-&gt;</span> template.<span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#34;Authorization&#34;</span>, <span style="color:#e6db74">&#34;Bearer token&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="feign-的使用场景">Feign 的使用场景</h2>
<h3 id="1微服务调用">（1）微服务调用</h3>
<ul>
<li>在微服务架构中，Feign 常用于服务之间的调用</li>
<li>自定义接口和注解，简化 HTTP 请求的编写</li>
</ul>
<h3 id="2负载均衡-1">（2）负载均衡</h3>
<ul>
<li>Feign 默认集成了 Ribbon，支持客户端负载均衡</li>
<li>可以根据配置选择不同的负载均衡策略</li>
</ul>
<h3 id="3熔断和降级-1">（3）熔断和降级</h3>
<ul>
<li>通过集成 Hystrix，Feign 支持熔断和降级机制</li>
<li>当服务不可用时，可以返回降级结果，避免系统崩溃</li>
</ul>
<h3 id="4自定义-http-客户端">（4）自定义 HTTP 客户端</h3>
<ul>
<li>Feign 支持自定义编码器、解码器和拦截器，满足复杂的业务需求</li>
</ul>
<h2 id="feign-的底层原理">Feign 的底层原理</h2>
<h3 id="1动态代理">（1）动态代理</h3>
<ul>
<li>Feign 通过 JDK 动态代理或者 CGLIB 生成接口的实现类</li>
<li>在运行时，Feign 会将方法调用转换为 HTTP 请求</li>
</ul>
<h3 id="2请求模版">（2）请求模版</h3>
<ul>
<li>Feign 使用 RequestTemplate 类表示 HTTP 请求模版</li>
<li>通过解析接口注解和方法参数，生成具体的 HTTP 请求</li>
</ul>
<h3 id="3编码器和解码器">（3）编码器和解码器</h3>
<ul>
<li>Feign 使用编码器将 Java 对象转换为 HTTP 请求体</li>
<li>使用编码器将 HTTP 响应体转为 Java 对象</li>
</ul>
<h3 id="4拦截器">（4）拦截器</h3>
<ul>
<li>Feign 支持请求拦截器，可以在发送请求前修改请求头或者请求体</li>
</ul>

<div class="mermaid my-8">
  graph TD
    A[客户端调用 Feign 接口方法] --> B[ReflectiveFeign.newInstance 创建动态代理]
    B --> C[InvocationHandler.invoke 拦截方法调用]
    C --> D[SynchronousMethodHandler.invoke 处理请求]
    D --> E[RequestTemplate.Factory.create 生成请求模板]
    E --> F[RequestInterceptor.apply 应用拦截器]
    F --> G[Encoder.encode 编码请求体]
    G --> H[LoadBalancerFeignClient.execute 选择服务实例]
    H --> I[Client.execute 发送 HTTP 请求]
    I --> J[Decoder.decode 解析响应]
    J --> K[返回结果给客户端]
</div>
</article>
<nav class="no-print post-nav">

	<a class="prev-post" href="http://xumf.net/blog/hbase/">
		<img class="icon-text" src="/img/prev.svg"/>HBase 深入浅出</a>


	<a class="next-post" href="http://xumf.net/blog/hystrix/">Hystrix<img class="icon-text" src="/img/next.svg"/>
	</a>

</nav>


<section id="related">
  <h4></h4>
  <ul>
    
  	<li><a href="/blog/springcloudconfig/">Spring Cloud Config</a></li>
  	
  	<li><a href="/blog/springcloudbus/">Spring Cloud Bus</a></li>
  	
  	<li><a href="/blog/eureka/">Eureka</a></li>
  	
  </ul>
</section>




	<div id="disqus_thread" class="no-print"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'xumf';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



  <script src="https://unpkg.com/mermaid@10.9.0/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const isDarkMode = document.documentElement.classList.contains('dark');
      
      mermaid.initialize({
        startOnLoad: true,
        theme: isDarkMode ? 'dark' : 'default',
        securityLevel: 'loose',
        fontFamily: "'Source Sans Pro', sans-serif",
        flowchart: { 
          curve: 'basis',
          htmlLabels: true
        }
      });
      
      mermaid.run({
        querySelector: '.mermaid',
        suppressErrors: true
      });
    });
  </script>
  
</footer>
